{% extends "documentation/index.html" %}

{% block title %}Documentation | Migrations{% endblock %}

{% block style %}
    <link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}css/lib/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}css/lib/shCoreEclipse.css"/>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/shCore.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/shBrushJava.js"></script>
    <script type="text/javascript">SyntaxHighlighter.all();</script>
{% endblock %}

{% block content %}

    <br />
    <img src="{{ MEDIA_URL }}img/headline-migrations.png" />
    <br /><br />

    Noboy is perfect. Even developers.

    <br /><br />

    In every project change happens. Old models need to be updated and new ones to be added. The latter is not problem, 
    as androrm simply recognizes your new models and creates new tables for them. The same does not hold, if you add fields
    to your existing models. To save time, androrm won't check each time if something has changed on your models and perform
    the respective updates. In the past that meant you need to manually drop the table and have it recreated by androrm. 
    We all knew, that this is not particularly good. To overcome this issue, we introduce <i>migrations</i>. This page will
    teach you how to update your model classes with ease.

    <h2><a name="basics" href="#basics">The Basics</a></h2>

    In order to run any migration on one of your models, you need to override the <pre>migrate</pre> method of the
    <pre>Model</pre> class. This method will be called, when androrm initializes all the models and is used to run
    any kind of migration. The following example shows you, how an empty <pre>migrate</pre> method would look like. 

    <pre class="brush: java">{% include "documentation/examples/models/migrations/basic.java" %}</pre>

    The <pre>context</pre> instance you need to hand to the method will later be used to roll out all migrations. 

    <hr />

    <h2><a name="adding_data_fields" href="#adding_data_fields">Adding Data Fields</a></h2>

    In most cases you have defined a model with some fields on it. We did so with the <pre>Author</pre> model. Currently,
    only a name can be assigned to an author. But maybe this author also wrote some book using a synonym. So first up, we
    add this new field to the model itself. 

    <pre class="brush: java">{% include "documentation/examples/models/migrations/field_no_migration.java" %}</pre>

    So far, so good. The problem here is, that androrm can actually not detect, that the signature of the tabel has changed
    and that a new field should be added. You need to help out a little bit. Using a <pre>Migrator</pre> instance, we
    will tell androrm what to do. 

    <pre class="brush: java">{% include "documentation/examples/models/migrations/field_migration.java" %}</pre>

    Using the <pre>migrator</pre> we can run several migrations on the model. The good thing here is, that androrm
    will keep track of the migrations, you have already done and if they are necessary. So if you code runs on a fresh
    install were everything is right in place from minute one, no migrations will be rolled out, and if it runs on an old
    installation the migrations will be applied. 

    <br /><br />

    What is important to mention, is that you should not remove migrations. All migrations, that you have applied to get 
    from the first version of your model, to your current one should remain in the <pre>migrate</pre> method. This will
    make sure, that everybody who is using your app will work on the same data scheme. 

    <hr />

    <h2><a name="adding_relational_fields" href="#adding_relational_fields">Adding Relational Fields</a></h2>

    <hr />

    <h2><a name="renaming_models" href="#renaming_models">Renaming Models</a></h2>

{% endblock %}

{% block menu_content %}
    <li>
        <a href="{% url documentation_index %}">Documentation</a>
    </li>
    <ul>
        <li>
            <a name="basics" href="#basics">The Basics</a>
        </li>
        <li>
            <a href="#adding_data_fields">Adding Data Fields</a>
        </li>
        <li>
            <a href="#adding_ralational_fields">Adding Relational Fields</a>
        </li>
        <li>
            <a href="#renaming_models">Renaming Models</a>
        </li>
    </ul>
{% endblock %}