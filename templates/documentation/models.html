{% extends "documentation/index.html" %}

{% block title %}Documentation | Models{% endblock %}

{% block style-before %}
    <link type="text/css" rel="stylesheet" href="{{ MEDIA_URL }}css/lib/prettify.css"/>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/lib/prettify.js"></script>
    <script type="text/javascript">
        $(document).observe("dom:loaded", function() {
            prettyPrint();
        })
    </script>
{% endblock %}

{% block content %}

    <article>
        <div class="a-content">
            <p class="lead">Defining Models</p>
            
            <section>
                <p class="lead">
                    <a name="basics" href="#basics">The Basics</a>
                </p>

                <p>
                    In order to get your model classes ready for automatic serialization and deserialization the first and <strong>most</strong> important step is to let them inherit from the androrm <code>Model</code> class. Doing so will immediately give you some predefined functions like <code>save</code> and <code>delete</code>, that can be used to store your models in the database or delete them, if you don't need them anymore.
                </p>
                
                <p>                
                    Each model class will get a <code>mId</code> field assigned to it, that androrm uses, to reference models. By default this will be a <code>PrimaryKey</code> field, that is handled by the database. If you want to use your own IDs, you can call the <code>Model</code> constructor with the <code>suppressAutoincremt</code> flag set to <code>true</code>. Now you only have to look out, that when you save your model for the first time, you call the <code>save</code> function with the additional <code>id</code> parameter.
                </p>
                
                <h4 class="a-code-caption">Example of model class, with autoincremented id field</h4>
                <pre class="prettyprint linenums">{% include "documentation/examples/models/autoincrement.java" %}</pre>
                
                <h4 class="a-code-caption">Example of model class, with manually set id</h4>
                <pre class="prettyprint linenums">{% include "documentation/examples/models/no_autoincrement.java" %}</pre>
            
            </section>

            <hr />
            
            <section>
                <p class="lead">
                    <a name="fields" href="#fields">Adding fields to your model</a>
                </p>

                <h3>Basic field types</h3>
                <p>
                    Of course a model also needs fields attached to it. Androrm comes with some predefined <a href="{% url documentation_fields %}">field types</a> for you. As androrm doesn't determine the database column names through any annotations on the fields, but uses reflection on the model classes to find the fields, there visibility has to be at least <code>protected</code>, so that they are accessibale from the <code>Model</code> class. You also have to provide a <strong>zero-argument</strong> constructor, in which you initialize your fields. Let's look at the next example, to get things clear. 
                </p>
                
                <pre class="prettyprint linenums">{% include "documentation/examples/models/model_book.java" %}</pre>    
                
                <p>
                    The <code>Book</code> class defines a <code>CharField</code> called <code>mTitle</code>. Luckily this field is also defined with <code>protected</code> visibility. So when androrm examines this field it will create a database table called <em>book</em> and also a column called mTitle in this table.
                </p>
                
                <p>
                    Ok, books are normally written by someone. So what we would create next is the author model. That could look like the following:
                </p>
                
                <pre class="prettyprint linenums">{% include "documentation/examples/models/model_author.java" %}</pre>    

                <h3>Relational fields</h3>

                <p>
                    Without androrm, you would now have to go and write all that SQL stuff, that links <code>Book</code> with <code>Author</code>. Overall, a mess. You don't want to do this. You want to create your app! 
                </p>
                
                <p>
                    But anyway, you want that connection between <code>Book</code> and <code>Author</code>. Here come the <a href="{% url documentation_relational_fields %}">relational fields</a> of androrm. We can now just link each book to an author, by defining a <code>ForeignKeyField</code> inside the <code>Book</code> model.
                </p>
                
                <pre class="prettyprint linenums">{% include "documentation/examples/models/model_book_with_author.java" %}</pre>

                <p>
                    Now actually we are not only talking about the relation of a <code>Book</code> to an <code>Author</code>. In many cases you probably also want to <a href="{% url documentation_making_queries %}">do queries</a> asking an author for all of his books. Therefore androrm offers you the <code>OneToManyField</code>. Behind the scenes, it will use the <code>ForeignKey</code> on <code>Book</code>, but that is nothing you have to worry about.  
                </p>

                <pre class="prettyprint linenums">{% include "documentation/examples/models/model_author_with_books.java" %}</pre>
            
            </section>

            <hr />
            
            <section>
                <p class="lead">
                    <a name="objects" href="#objects">The objects method</a>
                </p>

                <p>
                    To prepare your model for an easy to use query mechanism, you should also implement the <code>objects</code> method on each of your model classes. By default the <code>Model</code> class of androrm provides this method, but here you have to hand in the class of the model you are querying all the time. So, mostly only for convenience reasons, but also to have nicer looking code, implement your own <code>objects</code> method to be as DRY as possible. 
                </p>
                
                <pre class="prettyprint linenums">{% include "documentation/examples/models/objects.java" %}</pre>
                
                <p>
                    Don't be confused by the return type of this function. The <a href="{% url documentation_making_queries %}"> Making Queries</a> section will explain everything you need to know about this androrm mechanism.
                </p>
            </section>
            
            <hr />
                
            <p>
                If you want to learn more about field types, relations and how to make queries, then have a look at these pages:
            </p>
            
            <div class="a-list">
                <ul class="content-menu">
                    <li><a href="{% url documentation_fields %}">Field Types</a></li>
                    <li><a href="{% url documentation_relational_fields %}">Relational fields</a></li>
                    <li><a href="{% url documentation_making_queries %}">Making queries</a></li>
                </ul>
            </div>
            
            <hr />
            
            {% for category in categories %}
                <section>
                    <p class="lead">
                        <a href="{{ category.url }}">{{ category.name }}</a>
                    </p>

                    <p>
                        {{ category.description }}
                    </p>
                   
                   {% for subcategory in category.subcategories %}
                        <h4><a href="{{ subcategory.url }}">{{ subcategory.name }}</a></h4>

                        <p>
                            {{ subcategory.description }}
                        </p>
                    {% endfor %}
                    {% if not forloop.last %}
                        <hr />
                    {% endif %}
                </section>
            {% endfor %}
        </div>
    </article>
{% endblock %}

{% block menu_content %}
    <li><a href="{% url documentation_index %}">Documentation</a></li>
    <ul>
        <li>Defining Models</li>
        <ul>
            <li><a href="#basics">The Basics</a></li>
            <li><a href="#fields">Adding fields to your model</a></li>
            <li><a href="#objects">The objects method</a></li>
            <li><a href="{% url documentation_fields %}">Field Types</a></li>
            <li><a href="{% url documentation_migrations %}">Migrations</a></li>
        </ul>
    </ul>
{% endblock %}